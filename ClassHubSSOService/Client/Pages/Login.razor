@page "/login"
@inject HttpClient Http
@inject NavigationManager NavigationManager
@using SSOAuthorizationServer.Shared;

<PageTitle>SSO Login</PageTitle>

<header>
    <div class="logo">
        <img src="/images/logo.png"/>
    </div>
    <div class="title">
    가상 SSO(Single Sign On) 통합 로그인
    </div>
</header>

<div style="text-align: center;">
    <div class="text">
        <div class="circle"></div><br>
        <strong>통합로그인(SSO)란?</strong><br>
        <span>
            통합로그인은 한번의 로그인을 통하여 우리대학 전체 시스템에 추가 로그인 없이 이용 하실 수 있는 서비스 입니다.<br>
            Single Sign login is a service that allows you to use our entire system without additional login through one login.
        </span>
    </div>
</div>
<div class="loginArea">
    <p>@error</p>
    <div class="loginText">통합 로그인 | Single Sign On</div>
    <label>
        <span>ID</span><br>
        <input type="text" @bind-value="username" />
    </label>
    <br>
    <label>
        <span class = "input">비밀번호</span><br>
        <input type="password" @bind-value="password" />
    </label>
    <br>
    <button @onclick="OnLogin" class="loginBtn">로그인</button>
</div>

@code {
    @inject ILogger<Login> logger

    private string username;
    private string password;
    private string error;
    private string url;

    protected override void OnInitialized()
    {
        url = NavigationManager.Uri;
        Console.WriteLine(url);
    }

    private async void OnLogin()
    {
        logger.LogInformation("로그인 시도" + username);
        //로그인 버튼을 누르면 서버로 POST요청(body엔 ID와 PW)을 보냄
        
        var request = new SSOLoginRequest { UserId = username, Password = password, RedirectUri = NavigationManager.Uri };
        var response = await Http.PostAsJsonAsync<SSOLoginRequest>("SSOLogin", request);

        if (response.IsSuccessStatusCode)
        {
            string redirectUrl = await response.Content.ReadAsStringAsync();
            NavigationManager.NavigateTo(redirectUrl); // 리디렉션을 수행합니다.
        }
        else
        {
            error = "로그인에 실패했습니다. 아이디 또는 비밀번호를 확인해 주세요.";
        }
    }
}

<style>
    header {
        display: flex;
        align-items: center;
        width: 100%;
        height: 100px;
        background-color: RGB(8, 67, 165);
        font-size: 20px;
        color: #fff;
        margin: 0;
        padding: 0;
        padding-left: 200px;
    }

    .logo {
        margin-right: 20px;
        border-right: 1px solid #000;
        border-color: white;
        padding-right: 20px;
    }

    .title {
        font-size: 20px;
    }

    .text {
        padding-top: 80px;
        margin-bottom: 20px;
    }

    .circle {
        width: 10px;
        height: 10px;
        margin: 0 auto;
        border-radius: 50%;
        background-color: RGB(8, 67, 165);
    }

    .loginArea {
        width: 600px;
        height: 300px;
        align-items: center;
        padding-top: 10px;
        background-color: white;
        font-size: 15px;
        margin: 0 auto;
    }

    .loginText {
        width: 400px;
        align-items: center;
        font-size: 20px;
        color: gray;
        margin-left: 20px;
        margin-bottom: 20px;
    }

    .loginBtn {
        display: block;
        margin: 0 auto;
        width: 300px;
        height: 40px;
        border-radius: 30px;
        background-color: RGB(8, 67, 165);
        color: white;
        font-size: 15px;
        cursor: pointer;
        border: none;
    }

    strong {
        font-size: 30px;
    }

    label {
        display: block;
        font-size: 18px;
        color: RGB(8, 67, 165);
        text-align: center;
    }

    input {
        display: block;
        width: 90%;
        margin: 0 auto;
        margin-top: 5px;
        padding-bottom: 5px;
        font-size: 16px;
        border: 0;
        border-bottom: 1px solid rgba(0,0,0,0.4);
        background-color: rgba(0,0,0,0);
        text-align: center;
    }
</style>
